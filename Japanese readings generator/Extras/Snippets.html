<html>

<head>
<meta charset="UTF-8">
</head>
	
<body>
<script src="kanjidic2_raw.js"></script>
<script>
/* TO CREATE READINGS ARRAY ('kanjidic2_rdgs') FROM FULL .XML DATABASE STORED AS .JS STRING:

function charTo_0x_Notation(c){
	return '0x'+c.codePointAt(0).toString(16).toLocaleUpperCase();
}


var parser = new DOMParser();
var kanjidic2_xml = parser.parseFromString(kanjidic2,"text/xml");
	var chars = [...kanjidic2_xml.getElementsByTagName('character')];
	var kanjidic2_rdgs=[];
	chars.forEach((c)=>{
		let cdp=[...c.querySelectorAll('cp_value[cp_type="ucs"]')];
		let okn=[...c.querySelectorAll('reading[r_type="ja_on"]'), ...c.querySelectorAll('reading[r_type="ja_kun"]'), ...c.querySelectorAll('nanori')];
		 if(cdp.length==1 && okn.length>0){
			let okn_full=[];
			okn.forEach((r)=>{
				let d=r.textContent;
				let ds=d.split('.');
				let n=(r.nodeName=='nanori')?r.nodeName:r.getAttribute('r_type');
				for(let k=0, len=ds.length; k<len; k++){
					okn_full.push([ds[k].trim(),n]);
				}
			});
			kanjidic2_rdgs.push(['0x'+cdp[0].textContent.toLocaleUpperCase(), ...okn_full]);
		}
	});
	
const dak=[
	["0x304B","0x304C"],
	["0x304D","0x304E"],
	["0x304F","0x3050"],
	["0x3051","0x3052"],
	["0x3053","0x3054"],
	["0x3055","0x3056"],
	["0x3057","0x3058"],
	["0x3059","0x305A"],
	["0x305B","0x305C"],
	["0x305D","0x305E"],
	["0x305F","0x3060"],
	["0x3061","0x3062"],
	["0x3064","0x3065"],
	["0x3066","0x3067"],
	["0x3068","0x3069"],
	["0x306F","0x3070"],
	["0x3072","0x3073"],
	["0x3046","0x3094"],
	["0x3075","0x3076"],
	["0x3078","0x3079"],
	["0x307B","0x307C"],
	["0x30AB","0x30AC"],
	["0x30AD","0x30AE"],
	["0x30AF","0x30B0"],
	["0x30B1","0x30B2"],
	["0x30B3","0x30B4"],
	["0x30B5","0x30B6"],
	["0x30B7","0x30B8"],
	["0x30B9","0x30BA"],
	["0x30BB","0x30BC"],
	["0x30BD","0x30BE"],
	["0x30BF","0x30C0"],
	["0x30C1","0x30C2"],
	["0x30C4","0x30C5"],
	["0x30C6","0x30C7"],
	["0x30C8","0x30C9"],
	["0x30CF","0x30D0"],
	["0x30D2","0x30D3"],
	["0x30A6","0x3094"],
	["0x30D5","0x30D6"],
	["0x30D8","0x30D9"],
	["0x30DB","0x30DC"]
];

const hdak=[
	['0x306F','0x3071'],
	['0x3072','0x3074'],
	['0x3075','0x3077'],
	['0x3078','0x307A'],
	['0x307B','0x307D'],
	['0x30CF','0x30D1'],
	['0x30D2','0x30D4'],
	['0x30D5','0x30D7'],
	['0x30D8','0x30DA'],
	['0x30DB','0x30DD']
];

const hdak_309A=[
	'0x304B',
	'0x304D',
	'0x304F',
	'0x3051',
	'0x3053',
	'0x30AB',
	'0x30AD',
	'0x30AF',
	'0x30B1',
	'0x30B3'
];

//For (han)dakuten:

for(let i=0, len1=kanjidic2_rdgs.length; i<len1; i++){
	let  len2=kanjidic2_rdgs[i].length;
	for(let k=1; k<len2;  k++){
		let spl=[...kanjidic2_rdgs[i][k][0]];
		let is_309A=false;
		if(spl.length>=2){
			if( (hdak_309A.includes( charTo_0x_Notation(spl[0]) )  ) && (charTo_0x_Notation(spl[1])==='0x309A')
				){
					 is_309A=true;
				}
		}
		
		if(!is_309A){
			let a=spl[0];
			let ax=charTo_0x_Notation(a);
			let ix=hdak.findIndex((h)=>{return h[0]===ax;})
			if(ix>=0){
				let n=[String.fromCodePoint(hdak[ix][1]),...spl.slice(1)];
				kanjidic2_rdgs[i].push([n.join(''),kanjidic2_rdgs[i][k][1]+'_handakuten']);
			}			
			
			ix=hdak_309A.findIndex((h)=>{return h===ax;})
			if(ix>=0){
				let n=[String.fromCodePoint(hdak_309A[ix])+String.fromCodePoint('0x309A'),...spl.slice(1)];
				kanjidic2_rdgs[i].push([n.join(''),kanjidic2_rdgs[i][k][1]+'_handakuten']);
			}
			
			ix=dak.findIndex((d)=>{return d[0]===ax;})
			if(ix>=0){
				let n=[String.fromCodePoint(dak[ix][1]),...spl.slice(1)];
				kanjidic2_rdgs[i].push([n.join(''),kanjidic2_rdgs[i][k][1]+'_dakuten']);
			}		
		}	
	}
}

console.log(kanjidic2_rdgs);
*/
</script>
</body>

</html>